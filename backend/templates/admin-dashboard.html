<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - ShopEase</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
/* Analytics Dashboard Styles */
.analytics-period {
    display: flex;
    gap: 10px;
    align-items: center;
}

.analytics-period select {
    padding: 8px 15px;
    border: 1px solid rgba(70, 240, 210, 0.3);
    border-radius: 5px;
    background: rgba(26, 26, 46, 0.8);
    color: white;
    font-size: 14px;
}

/* Analytics Cards */
.analytics-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.analytics-card {
    background: rgba(26, 26, 46, 0.8);
    border-radius: 10px;
    padding: 20px;
    border: 1px solid rgba(70, 240, 210, 0.2);
    display: flex;
    align-items: center;
    gap: 15px;
    transition: transform 0.3s ease;
}

.analytics-card:hover {
    transform: translateY(-5px);
    border-color: var(--accent-color);
}

.analytics-card-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

.analytics-card-content {
    flex: 1;
}

.analytics-card h3 {
    margin: 0 0 5px 0;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 500;
}

.analytics-card-value {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin-bottom: 5px;
}

.analytics-card-change {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
}

.change-indicator {
    padding: 2px 6px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 11px;
}

.change-positive {
    background: rgba(40, 167, 69, 0.2);
    color: #28a745;
}

.change-negative {
    background: rgba(220, 53, 69, 0.2);
    color: #dc3545;
}

.change-neutral {
    background: rgba(108, 117, 125, 0.2);
    color: #6c757d;
}

.change-label {
    color: rgba(255, 255, 255, 0.6);
}

.analytics-card-subtitle {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
}

/* Charts Container */
.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.chart-card {
    background: rgba(26, 26, 46, 0.8);
    border-radius: 10px;
    padding: 20px;
    border: 1px solid rgba(70, 240, 210, 0.2);
}

.chart-card.full-width {
    grid-column: 1 / -1;
}

.chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.chart-header h3 {
    margin: 0;
    color: white;
    font-size: 18px;
}

.chart-legend {
    display: flex;
    gap: 15px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    color: rgba(255, 255, 255, 0.8);
}

.legend-color {
    width: 10px;
    height: 10px;
    border-radius: 2px;
}

.chart-actions {
    display: flex;
    gap: 10px;
}

.chart-action-btn {
    background: rgba(26, 26, 46, 0.6);
    border: 1px solid rgba(70, 240, 210, 0.3);
    border-radius: 5px;
    color: rgba(255, 255, 255, 0.8);
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.chart-action-btn:hover {
    background: rgba(70, 240, 210, 0.1);
    color: var(--accent-color);
}

.chart-subtitle {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
}

.chart-container {
    height: 250px;
    position: relative;
}

.view-all-btn {
    padding: 5px 15px;
    background: rgba(70, 240, 210, 0.1);
    border: 1px solid rgba(70, 240, 210, 0.3);
    border-radius: 5px;
    color: var(--accent-color);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
}

.view-all-btn:hover {
    background: rgba(70, 240, 210, 0.2);
}

/* Analytics Tables */
.table-container {
    overflow-x: auto;
}

.analytics-table {
    width: 100%;
    border-collapse: collapse;
}

.analytics-table th {
    padding: 12px 15px;
    text-align: left;
    font-weight: 600;
    color: var(--accent-color);
    border-bottom: 2px solid rgba(70, 240, 210, 0.2);
    background: rgba(26, 26, 46, 0.9);
}

.analytics-table td {
    padding: 10px 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.analytics-table tbody tr:hover {
    background: rgba(70, 240, 210, 0.05);
}

.loading-cell {
    text-align: center;
    color: rgba(255, 255, 255, 0.6);
    padding: 30px !important;
}

.performance-bar {
    width: 100px;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
}

.performance-fill {
    height: 100%;
    background: var(--accent-color);
    border-radius: 3px;
}
        /* Order Management Styles */
.orders-table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(26, 26, 46, 0.8);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    margin-top: 20px;
}

.orders-table thead {
    background: rgba(70, 240, 210, 0.1);
}

.orders-table th {
    padding: 15px;
    text-align: left;
    font-weight: 600;
    color: var(--accent-color);
    border-bottom: 2px solid rgba(70, 240, 210, 0.2);
}

.orders-table td {
    padding: 12px 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.orders-table tbody tr:hover {
    background: rgba(70, 240, 210, 0.05);
}

.orders-table tbody tr:last-child td {
    border-bottom: none;
}

.order-number {
    font-family: 'Courier New', monospace;
    color: var(--accent-color);
    font-weight: 600;
}

.order-status {
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.status-confirmed {
    background: rgba(70, 240, 210, 0.2);
    color: var(--accent-color);
}

.status-pending {
    background: rgba(255, 193, 7, 0.2);
    color: #ffc107;
}

.status-cancelled {
    background: rgba(220, 53, 69, 0.2);
    color: #dc3545;
}

.status-completed {
    background: rgba(40, 167, 69, 0.2);
    color: #28a745;
}

.order-user {
    display: flex;
    align-items: center;
    gap: 10px;
}

.order-user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--accent-color);
    color: var(--dark-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
}

.order-items {
    max-width: 200px;
}

.order-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
    padding: 5px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 5px;
}

.order-item-name {
    font-size: 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
}

.order-item-qty {
    font-size: 11px;
    color: var(--accent-color);
    margin-left: 10px;
}

.order-total {
    font-weight: 600;
    color: var(--accent-color);
}

.order-date {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.7);
}

.order-shipping {
    max-width: 250px;
}

.order-shipping-info {
    font-size: 12px;
    line-height: 1.4;
}

.order-actions {
    display: flex;
    gap: 8px;
}

.order-action-btn {
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.update-status-btn {
    background: rgba(70, 240, 210, 0.2);
    color: var(--accent-color);
}

.update-status-btn:hover {
    background: rgba(70, 240, 210, 0.3);
}

.view-details-btn {
    background: rgba(13, 110, 253, 0.2);
    color: #0d6efd;
}

.view-details-btn:hover {
    background: rgba(13, 110, 253, 0.3);
}

.delete-order-btn {
    background: rgba(220, 53, 69, 0.2);
    color: #dc3545;
}

.delete-order-btn:hover {
    background: rgba(220, 53, 69, 0.3);
}

/* Order Details Modal */
.order-details-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.order-details-content {
    background: var(--dark-bg);
    border-radius: 15px;
    padding: 30px;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
}

.order-details-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    border-bottom: 2px solid rgba(70, 240, 210, 0.3);
    padding-bottom: 15px;
}

.order-details-title {
    color: var(--accent-color);
    margin: 0;
}

.order-details-close {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    padding: 5px;
}

.order-details-body {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.order-info-section {
    background: rgba(26, 26, 46, 0.6);
    padding: 20px;
    border-radius: 10px;
}

.order-info-section h3 {
    color: var(--accent-color);
    margin-top: 0;
    margin-bottom: 15px;
    border-bottom: 1px solid rgba(70, 240, 210, 0.2);
    padding-bottom: 10px;
}

.order-details-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.order-details-item:last-child {
    border-bottom: none;
}

.order-details-label {
    font-weight: 600;
    color: rgba(255, 255, 255, 0.8);
}

.order-details-value {
    color: white;
    text-align: right;
}

.order-details-value.total {
    color: var(--accent-color);
    font-weight: bold;
    font-size: 18px;
}

.order-items-list {
    margin-top: 10px;
}

.order-item-detail {
    display: flex;
    align-items: center;
    padding: 10px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 5px;
    margin-bottom: 10px;
}

.order-item-detail:last-child {
    margin-bottom: 0;
}

.order-item-image {
    width: 50px;
    height: 50px;
    border-radius: 8px;
    object-fit: cover;
    margin-right: 15px;
}

.order-item-info {
    flex: 1;
}

.order-item-name {
    font-weight: 600;
    margin-bottom: 5px;
}

.order-item-meta {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
}
        :root {
            --logo-color: #46F0D2;
            --border: #CFA97E;
            --dark-bg: #0a0a14;
            --card-bg: rgba(20, 20, 30, 0.9);
            --text-light: #ffffff;
            --accent-color: #46F0D2;
            --secondary-color: #CFA97E;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: var(--dark-bg);
            color: var(--text-light);
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
        }
        
        .admin-header {
            background: var(--card-bg);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 32px;
            color: var(--accent-color);
        }
        
        .logo h1 {
            font-size: 28px;
            color: var(--accent-color);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logout-btn {
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.3s ease;
        }
        
        .logout-btn:hover {
            transform: translateY(-2px);
        }
        
        .admin-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        
        .sidebar {
            width: 250px;
            background: var(--card-bg);
            border-right: 2px solid var(--border);
            padding: 30px 0;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            padding: 15px 30px;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .sidebar-menu li:hover,
        .sidebar-menu li.active {
            background: rgba(70, 240, 210, 0.1);
            border-left-color: var(--accent-color);
        }
        
        .sidebar-menu i {
            margin-right: 10px;
            color: var(--accent-color);
            width: 20px;
        }
        
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }
        
        .card h3 {
            color: var(--accent-color);
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .card-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .section-title {
            color: var(--accent-color);
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .products-container {
            background: var(--card-bg);
            border-radius: 15px;
            border: 1px solid var(--border);
            overflow: hidden;
        }
        
        .products-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .products-table th {
            background: rgba(70, 240, 210, 0.1);
            color: var(--accent-color);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
        }
        
        .products-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(207, 169, 126, 0.2);
        }
        
        .products-table tr:hover {
            background: rgba(70, 240, 210, 0.05);
        }
        
        .product-image {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .edit-btn {
            background: rgba(70, 240, 210, 0.2);
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
        }
        
        .edit-btn:hover {
            background: var(--accent-color);
            color: var(--dark-bg);
        }
        
        .delete-btn {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        
        .delete-btn:hover {
            background: #e74c3c;
            color: white;
        }
        
        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            background: rgba(70, 240, 210, 0.1);
            color: var(--accent-color);
            border: 1px solid rgba(70, 240, 210, 0.3);
        }
        
        .price-tag {
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #f1c40f;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--accent-color);
        }
        
        .error {
            color: #e74c3c;
            padding: 10px;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success {
            color: #2ecc71;
            padding: 10px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 15px;
        }
        
        .add-product-btn {
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .add-product-btn:hover {
            transform: translateY(-2px);
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 15px;
            border: 2px solid var(--border);
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .modal-title {
            color: var(--accent-color);
            font-size: 24px;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s ease;
        }
        
        .close-btn:hover {
            color: var(--secondary-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--accent-color);
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(20, 20, 30, 0.7);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-light);
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        
        .cancel-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-light);
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .cancel-btn:hover {
            background: rgba(207, 169, 126, 0.1);
        }
        
        .save-btn {
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.3s ease;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
        }
        
        .save-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .image-preview {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .preview-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 2px solid var(--border);
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .products-table {
                display: block;
                overflow-x: auto;
            }
            
            .products-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        /* Add to existing styles */
.users-container {
    background: var(--card-bg);
    border-radius: 15px;
    border: 1px solid var(--border);
    overflow: hidden;
}

.users-table {
    width: 100%;
    border-collapse: collapse;
}

.users-table th {
    background: rgba(70, 240, 210, 0.1);
    color: var(--accent-color);
    padding: 15px;
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--border);
}

.users-table td {
    padding: 15px;
    border-bottom: 1px solid rgba(207, 169, 126, 0.2);
}

.users-table tr:hover {
    background: rgba(70, 240, 210, 0.05);
}

.role-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
}

.role-admin {
    background: rgba(52, 152, 219, 0.1);
    color: #3498db;
    border: 1px solid rgba(52, 152, 219, 0.3);
}

.role-user {
    background: rgba(46, 204, 113, 0.1);
    color: #2ecc71;
    border: 1px solid rgba(46, 204, 113, 0.3);
}

.user-actions {
    display: flex;
    gap: 10px;
}

.promote-btn {
    background: rgba(52, 152, 219, 0.2);
    color: #3498db;
    border: 1px solid #3498db;
}

.promote-btn:hover {
    background: #3498db;
    color: white;
}

.demote-btn {
    background: rgba(241, 196, 15, 0.2);
    color: #f1c40f;
    border: 1px solid #f1c40f;
}

.demote-btn:hover {
    background: #f1c40f;
    color: var(--dark-bg);
}

.delete-user-btn {
    background: rgba(231, 76, 60, 0.2);
    color: #e74c3c;
    border: 1px solid #e74c3c;
}

.delete-user-btn:hover {
    background: #e74c3c;
    color: white;
}

.user-stats {
    display: flex;
    align-items: center;
    gap: 15px;
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 16px;
}

/* Order Items Management Styles */
.order-items-filter {
    display: flex;
    gap: 20px;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(26, 26, 46, 0.6);
    border-radius: 10px;
    flex-wrap: wrap;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
    min-width: 200px;
}

.filter-group label {
    font-size: 14px;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.8);
}

.filter-group select {
    padding: 8px 12px;
    border: 1px solid rgba(70, 240, 210, 0.3);
    border-radius: 5px;
    background: rgba(26, 26, 46, 0.8);
    color: white;
    font-size: 14px;
}

.refresh-btn {
    padding: 8px 15px;
    background: rgba(70, 240, 210, 0.2);
    border: 1px solid rgba(70, 240, 210, 0.3);
    border-radius: 5px;
    color: var(--accent-color);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.refresh-btn:hover {
    background: rgba(70, 240, 210, 0.3);
}

/* Order Items Table */
.order-items-table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(26, 26, 46, 0.8);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    margin-top: 20px;
}

.order-items-table thead {
    background: rgba(70, 240, 210, 0.1);
}

.order-items-table th {
    padding: 15px;
    text-align: left;
    font-weight: 600;
    color: var(--accent-color);
    border-bottom: 2px solid rgba(70, 240, 210, 0.2);
}

.order-items-table td {
    padding: 12px 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.order-items-table tbody tr:hover {
    background: rgba(70, 240, 210, 0.05);
}

.order-items-table tbody tr:last-child td {
    border-bottom: none;
}

.order-item-details {
    display: flex;
    align-items: center;
    gap: 15px;
}

.order-item-image {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    object-fit: cover;
    background: rgba(70, 240, 210, 0.1);
}

.order-item-info {
    flex: 1;
}

.order-item-name {
    font-weight: 600;
    margin-bottom: 5px;
}

.order-item-meta {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
}

.order-number-cell {
    font-family: 'Courier New', monospace;
    color: var(--accent-color);
    font-weight: 600;
}

.order-item-quantity {
    display: inline-block;
    padding: 4px 8px;
    background: rgba(70, 240, 210, 0.1);
    border-radius: 4px;
    font-weight: 600;
    color: var(--accent-color);
}

.order-item-price {
    color: var(--accent-color);
    font-weight: 600;
}

.order-item-total {
    color: white;
    font-weight: 600;
}

.order-item-date {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
}

.order-item-status {
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
}

.status-sold {
    background: rgba(40, 167, 69, 0.2);
    color: #28a745;
}

/* Order Items Cards View */
.order-items-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.order-item-card {
    background: rgba(26, 26, 46, 0.8);
    border-radius: 10px;
    padding: 20px;
    border: 1px solid rgba(70, 240, 210, 0.2);
    transition: all 0.3s ease;
}

.order-item-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    border-color: var(--accent-color);
}

.order-item-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(70, 240, 210, 0.2);
}

.order-item-order {
    font-family: 'Courier New', monospace;
    color: var(--accent-color);
    font-weight: 600;
    font-size: 14px;
}

.order-item-date {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
}

.order-item-card-body {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
}

.order-item-card-image {
    width: 80px;
    height: 80px;
    border-radius: 8px;
    object-fit: cover;
    background: rgba(70, 240, 210, 0.1);
}

.order-item-card-info {
    flex: 1;
}

.order-item-card-name {
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 16px;
}

.order-item-card-meta {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 5px;
}

.order-item-card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.order-item-card-price {
    color: var(--accent-color);
    font-weight: 600;
    font-size: 18px;
}

.order-item-card-quantity {
    display: flex;
    align-items: center;
    gap: 10px;
}

.quantity-badge {
    padding: 5px 15px;
    background: rgba(70, 240, 210, 0.1);
    border-radius: 20px;
    font-weight: 600;
    color: var(--accent-color);
}

.order-item-card-actions {
    display: flex;
    gap: 10px;
}

.order-item-card-btn {
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-view-product {
    background: rgba(13, 110, 253, 0.2);
    color: #0d6efd;
}

.btn-view-product:hover {
    background: rgba(13, 110, 253, 0.3);
}

.btn-view-order {
    background: rgba(70, 240, 210, 0.2);
    color: var(--accent-color);
}

.btn-view-order:hover {
    background: rgba(70, 240, 210, 0.3);
}

/* View Toggle Buttons */
.view-toggle {
    display: flex;
    gap: 10px;
    margin-left: auto;
}

.view-toggle-btn {
    padding: 8px 15px;
    background: rgba(26, 26, 46, 0.6);
    border: 1px solid rgba(70, 240, 210, 0.3);
    border-radius: 5px;
    color: rgba(255, 255, 255, 0.8);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
}

.view-toggle-btn.active {
    background: rgba(70, 240, 210, 0.2);
    color: var(--accent-color);
    border-color: var(--accent-color);
}

.view-toggle-btn:hover:not(.active) {
    background: rgba(70, 240, 210, 0.1);
}
    </style>
</head>
<body>
    <header class="admin-header">
        <div class="logo">
            <i class="fas fa-tachometer-alt logo-icon"></i>
            <h1>ShopEase Admin</h1>
        </div>
        <div class="user-info">
            <span id="adminName">Loading...</span>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </header>
    
    <div class="admin-container">
       <nav class="sidebar">
    <ul class="sidebar-menu">
        <li class="active" onclick="showSection('dashboard')">
            <i class="fas fa-tachometer-alt"></i> Dashboard
        </li>
        <li onclick="showSection('products')">
            <i class="fas fa-box"></i> Products
        </li>
        <li onclick="showSection('orders')">
            <i class="fas fa-shopping-cart"></i> Orders
        </li>
        <li onclick="showSection('order-items')">
            <i class="fas fa-list-alt"></i> Order Items
        </li>
        <li onclick="showSection('users')">
            <i class="fas fa-users"></i> Users
        </li>
        <li onclick="showSection('analytics')">
            <i class="fas fa-chart-line"></i> Analytics
        </li>
    </ul>
</nav>
        
        <main class="main-content">
            <div id="dashboard-section">
                <h2 class="section-title">Dashboard Overview</h2>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>Total Revenue</h3>
                        <div class="card-value" id="totalRevenue">$0</div>
                        <div>All time revenue</div>
                    </div>
                    
                    <div class="card">
                        <h3>Total Orders</h3>
                        <div class="card-value" id="totalOrders">0</div>
                        <div>Orders placed</div>
                    </div>
                    
                    <div class="card">
                        <h3>Total Users</h3>
                        <div class="card-value" id="totalUsers">0</div>
                        <div>Registered users</div>
                        
                    </div>
                    
                    <div class="card">
                        <h3>Total Products</h3>
                        <div class="card-value" id="totalProducts">0</div>
                        <div>Products available</div>
                    </div>
                </div>
            </div>
            
            <div id="products-section" style="display: none;">
                <div class="products-header">
                    <h2 class="section-title">Product Management</h2>
                    <button class="add-product-btn" onclick="openProductModal()">
                        <i class="fas fa-plus"></i> Add New Product
                    </button>
                </div>
                
                <div id="statusMessage" style="display: none;"></div>
                
                <div class="products-container">
                    <div id="productsTable">
                        <div class="loading">Loading products...</div>
                    </div>
                </div>
            </div>
            
           <div id="orders-section" style="display: none;">
    <div class="products-header">
        <h2 class="section-title">Order Management</h2>
        <div class="order-stats">
            <span id="totalOrdersCount" style="color: var(--accent-color); font-weight: 600;">0 Orders</span>
        </div>
    </div>
    
    <div id="orderStatusMessage" style="display: none;"></div>
    
    <div class="products-container">
        <div id="ordersTable">
            <div class="loading">Loading orders...</div>
        </div>
    </div>
</div>
            <div id="order-items-section" style="display: none;">
    <div class="products-header">
        <h2 class="section-title">Order Items Management</h2>
        <div class="order-stats">
            <span id="totalOrderItemsCount" style="color: var(--accent-color); font-weight: 600;">0 Items</span>
        </div>
    </div>
    
    <div id="orderItemsStatusMessage" style="display: none;"></div>
    
    <!-- Order Items Filter -->
    <div class="order-items-filter">
        <div class="filter-group">
            <label for="filterOrder">Filter by Order:</label>
            <select id="filterOrder" onchange="filterOrderItems()">
                <option value="">All Orders</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="filterProduct">Filter by Product:</label>
            <select id="filterProduct" onchange="filterOrderItems()">
                <option value="">All Products</option>
            </select>
        </div>
        <button class="refresh-btn" onclick="loadOrderItems()">
            <i class="fas fa-sync-alt"></i> Refresh
        </button>
    </div>
    
    <div class="products-container">
        <div id="orderItemsTable">
            <div class="loading">Loading order items...</div>
        </div>
    </div>
</div>
            <div id="users-section" style="display: none;">
                <div class="products-header">
                    <h2 class="section-title">User Management</h2>
                    <div class="user-stats">
                        <span id="totalUsersCount" style="color: var(--accent-color); font-weight: 600;">0 Users</span>
                    </div>
                </div>
                
                <div id="userStatusMessage" style="display: none;"></div>
                
                <div class="products-container">
                    <div id="usersTable">
                        <div class="loading">Loading users...</div>
                    </div>
                </div>
            </div>
            
<div id="analytics-section" style="display: none;">
    <div class="products-header">
        <h2 class="section-title">Sales Analytics Dashboard</h2>
        <div class="analytics-period">
            <select id="analyticsPeriod" onchange="loadAnalytics()">
                <option value="7">Last 7 Days</option>
                <option value="30" selected>Last 30 Days</option>
                <option value="90">Last 90 Days</option>
                <option value="365">Last Year</option>
                <option value="all">All Time</option>
            </select>
            <button class="refresh-btn" onclick="loadAnalytics()">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
        </div>
    </div>
    
    <div id="analyticsStatusMessage" style="display: none;"></div>
    
    <!-- Analytics Summary Cards -->
    <div class="analytics-cards">
        <div class="analytics-card">
            <div class="analytics-card-icon" style="background: rgba(70, 240, 210, 0.1);">
                <i class="fas fa-chart-line" style="color: var(--accent-color);"></i>
            </div>
            <div class="analytics-card-content">
                <h3>Revenue</h3>
                <div class="analytics-card-value" id="analyticsRevenue">$0</div>
                <div class="analytics-card-change" id="revenueChange">
                    <span class="change-indicator neutral">0%</span>
                    <span class="change-label">vs yesterday</span>
                </div>
            </div>
        </div>
        
        <div class="analytics-card">
            <div class="analytics-card-icon" style="background: rgba(40, 167, 69, 0.1);">
                <i class="fas fa-shopping-cart" style="color: #28a745;"></i>
            </div>
            <div class="analytics-card-content">
                <h3>Total Orders</h3>
                <div class="analytics-card-value" id="totalOrdersAnalytics">0</div>
                <div class="analytics-card-subtitle" id="todayOrders">Today: 0 orders</div>
            </div>
        </div>
        
        <div class="analytics-card">
            <div class="analytics-card-icon" style="background: rgba(255, 193, 7, 0.1);">
                <i class="fas fa-dollar-sign" style="color: #ffc107;"></i>
            </div>
            <div class="analytics-card-content">
                <h3>Avg Order Value</h3>
                <div class="analytics-card-value" id="avgOrderValue">$0</div>
                <div class="analytics-card-subtitle">Per order average</div>
            </div>
        </div>
        
        <div class="analytics-card">
            <div class="analytics-card-icon" style="background: rgba(13, 110, 253, 0.1);">
                <i class="fas fa-box" style="color: #0d6efd;"></i>
            </div>
            <div class="analytics-card-content">
                <h3>Top Product</h3>
                <div class="analytics-card-value" id="topProductName">-</div>
                <div class="analytics-card-subtitle" id="topProductSales">0 units sold</div>
            </div>
        </div>
    </div>
    
    <!-- Charts Container -->
    <div class="charts-container">
        <!-- Sales Trend Chart -->
        <div class="chart-card">
            <div class="chart-header">
                <h3>Sales Trend</h3>
                <div class="chart-legend">
                    <span class="legend-item">
                        <span class="legend-color" style="background-color: var(--accent-color);"></span>
                        Revenue
                    </span>
                    <span class="legend-item">
                        <span class="legend-color" style="background-color: #28a745;"></span>
                        Orders
                    </span>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="salesTrendChart"></canvas>
            </div>
        </div>
        
        <!-- Category Sales Chart -->
        <div class="chart-card">
            <div class="chart-header">
                <h3>Category Performance</h3>
                <div class="chart-actions">
                    <button class="chart-action-btn" onclick="toggleChartType('categoryChart')">
                        <i class="fas fa-exchange-alt"></i>
                    </button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="categoryChart"></canvas>
            </div>
        </div>
        
        <!-- Hourly Sales Chart -->
        <div class="chart-card">
            <div class="chart-header">
                <h3>Today's Hourly Sales</h3>
                <div class="chart-subtitle" id="todayDate"></div>
            </div>
            <div class="chart-container">
                <canvas id="hourlyChart"></canvas>
            </div>
        </div>
        
        <!-- Top Products Table -->
        <div class="chart-card full-width">
            <div class="chart-header">
                <h3>Top Selling Products</h3>
                <div class="chart-subtitle">Best performers by quantity sold</div>
            </div>
            <div class="table-container">
                <table class="analytics-table" id="topProductsTable">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Units Sold</th>
                            <th>Revenue</th>
                            <th>Avg Price</th>
                            <th>Performance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5" class="loading-cell">Loading top products...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Recent Orders -->
        <div class="chart-card full-width">
            <div class="chart-header">
                <h3>Recent Orders</h3>
                <button class="view-all-btn" onclick="showSection('orders')">
                    View All Orders <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            <div class="table-container">
                <table class="analytics-table" id="recentOrdersTable">
                    <thead>
                        <tr>
                            <th>Order #</th>
                            <th>Customer</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Items</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="6" class="loading-cell">Loading recent orders...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

    <!-- Product Modal -->
    <div id="productModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Add New Product</h2>
                <button class="close-btn" onclick="closeProductModal()">&times;</button>
            </div>
            
            <form id="productForm">
                <div class="form-group">
                    <label class="form-label" for="productName">Product Name *</label>
                    <input type="text" id="productName" class="form-control" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="productCategory">Category *</label>
                        <select id="productCategory" class="form-control" required>
                            <option value="">Select category</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productPrice">Price ($) *</label>
                        <input type="number" id="productPrice" class="form-control" min="0" step="0.01" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="productRating">Rating (0-5)</label>
                        <input type="number" id="productRating" class="form-control" min="0" max="5" step="0.1" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productReviews">Reviews Count</label>
                        <input type="number" id="productReviews" class="form-control" min="0" value="0">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="productImage">Image URL</label>
                    <input type="text" id="productImage" class="form-control" 
                           placeholder="https://example.com/image.jpg">
                    <div class="image-preview" id="imagePreview" style="display: none;">
                        <img src="" alt="Preview" class="preview-image" id="previewImage">
                        <small>Image Preview</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="productDescription">Description *</label>
                    <textarea id="productDescription" class="form-control" rows="4" required></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeProductModal()">Cancel</button>
                    <button type="submit" class="save-btn" id="saveBtn">
                        <span id="saveBtnText">Save Product</span>
                        <span id="saveBtnLoader" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i> Saving...
                        </span>
                    </button>
                </div>
                
                <input type="hidden" id="productId" value="">
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let categories = [];
        let currentProductId = null;
        
        // Check authentication on page load
        async function checkAuth() {
            try {
                const response = await fetch('http://localhost:5000/api/check-auth');
                const data = await response.json();
                
                if (!data.authenticated || data.user.role !== 'admin') {
                    // Redirect to login if not authenticated as admin
                    alert('Access denied. Admin privileges required.');
                    window.location.href = 'http://localhost:5000/login';
                    return;
                }
                
                // Update admin name
                document.getElementById('adminName').textContent = `Welcome, ${data.user.username}`;
                
                // Load dashboard data
                loadDashboardData();
                // Load categories
                loadCategories();
                
            } catch (error) {
                console.error('Auth check failed:', error);
                window.location.href = 'http://localhost:5000/login';
            }
        }
        
async function loadDashboardData() {
    try {
        // Fetch users count
        const usersResponse = await fetch('http://localhost:5000/api/admin/users', {
            credentials: 'include'
        });
        
        if (usersResponse.ok) {
            const usersData = await usersResponse.json();
            if (usersData.success) {
                document.getElementById('totalUsers').textContent = usersData.count || usersData.users?.length || 0;
            }
        }
        
        // Fetch products count
        const productsResponse = await fetch('http://localhost:5000/api/admin/products', {
            credentials: 'include'
        });
        
        if (productsResponse.ok) {
            const productsData = await productsResponse.json();
            if (productsData.success) {
                document.getElementById('totalProducts').textContent = productsData.products?.length || 0;
            }
        }
        
        // Fetch orders data
        const ordersResponse = await fetch('http://localhost:5000/api/admin/orders', {
            credentials: 'include'
        });
        
        if (ordersResponse.ok) {
            const ordersData = await ordersResponse.json();
            if (ordersData.success) {
                document.getElementById('totalOrders').textContent = ordersData.count || ordersData.orders?.length || 0;
                
                // Calculate total revenue
                let totalRevenue = 0;
                if (ordersData.orders && ordersData.orders.length > 0) {
                    totalRevenue = ordersData.orders.reduce((sum, order) => sum + (order.total_amount || 0), 0);
                }
                document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
            }
        } else {
            setDefaultStats();
        }
        
    } catch (error) {
        console.error('Error loading dashboard data:', error);
        setDefaultStats();
    }
}
function setDefaultStats() {
    document.getElementById('totalRevenue').textContent = '$0';
    document.getElementById('totalOrders').textContent = '0';
    document.getElementById('totalUsers').textContent = '0';
    document.getElementById('totalProducts').textContent = '0';
}
        // Load categories for dropdown
        async function loadCategories() {
            try {
                const response = await fetch('http://localhost:5000/api/categories', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.success) {
                    categories = data.categories;
                    updateCategoryDropdown();
                }
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }
        
        // Update category dropdown
        function updateCategoryDropdown() {
            const categorySelect = document.getElementById('productCategory');
            categorySelect.innerHTML = '<option value="">Select category</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                categorySelect.appendChild(option);
            });
        }
        
        // Load products
        async function loadProducts() {
            try {
                const response = await fetch('http://localhost:5000/api/admin/products', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.success) {
                    displayProducts(data.products);
                } else {
                    document.getElementById('productsTable').innerHTML = `<div class="error">Error: ${data.error || 'Failed to load products'}</div>`;
                }
                
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('productsTable').innerHTML = `<div class="error">Failed to load products. Please try again.</div>`;
            }
        }
        
        // Display products in table
        function displayProducts(products) {
            if (!products || products.length === 0) {
                document.getElementById('productsTable').innerHTML = '<div class="loading">No products found. Add your first product!</div>';
                return;
            }
            
            let html = `
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Rating</th>
                            <th>Reviews</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            products.forEach(product => {
                html += `
                    <tr>
                        <td>${product.id}</td>
                        <td>
                            ${product.image ? 
                                `<img src="${product.image}" alt="${product.name}" class="product-image" onerror="this.src='https://via.placeholder.com/50x50/1a1a2e/46f0d2?text=No+Image'">` : 
                                '<div style="width:50px;height:50px;background:rgba(70,240,210,0.1);border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--accent-color);"><i class="fas fa-image"></i></div>'}
                        </td>
                        <td>${product.name}</td>
                        <td><span class="category-badge">${product.category || 'Uncategorized'}</span></td>
                        <td class="price-tag">$${product.price?.toFixed(2) || '0.00'}</td>
                        <td class="rating">
                            ${getStarRating(product.rating || 0)}
                            <span>${product.rating?.toFixed(1) || '0.0'}</span>
                        </td>
                        <td>${product.reviews || 0}</td>
                        <td>
                            <div class="product-actions">
                                <button class="action-btn edit-btn" onclick="editProduct(${product.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteProduct(${product.id}, '${escapeString(product.name)}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            document.getElementById('productsTable').innerHTML = html;
        }
        
        // Escape string for use in JavaScript
        function escapeString(str) {
            return str.replace(/'/g, "\\'").replace(/"/g, '\\"');
        }
        
        // Generate star rating HTML
        function getStarRating(rating) {
            let stars = '';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            
            for (let i = 1; i <= 5; i++) {
                if (i <= fullStars) {
                    stars += '<i class="fas fa-star"></i>';
                } else if (i === fullStars + 1 && hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            
            return stars;
        }
        
        // Open product modal for adding new product
        function openProductModal(product = null) {
            const modal = document.getElementById('productModal');
            const modalTitle = document.getElementById('modalTitle');
            const form = document.getElementById('productForm');
            
            if (product) {
                // Edit mode
                modalTitle.textContent = 'Edit Product';
                currentProductId = product.id;
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productRating').value = product.rating || 0;
                document.getElementById('productReviews').value = product.reviews || 0;
                document.getElementById('productImage').value = product.image || '';
                document.getElementById('productDescription').value = product.description;
                
                // Update image preview if exists
                if (product.image) {
                    updateImagePreview(product.image);
                }
            } else {
                // Add mode
                modalTitle.textContent = 'Add New Product';
                currentProductId = null;
                form.reset();
                document.getElementById('productId').value = '';
                document.getElementById('imagePreview').style.display = 'none';
            }
            
            modal.style.display = 'flex';
        }
        
        // Close product modal
        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
            document.getElementById('productForm').reset();
            currentProductId = null;
        }
        
        // Update image preview
        document.getElementById('productImage').addEventListener('input', function(e) {
            const url = e.target.value.trim();
            updateImagePreview(url);
        });
        
        function updateImagePreview(url) {
            const previewContainer = document.getElementById('imagePreview');
            const previewImage = document.getElementById('previewImage');
            
            if (url) {
                previewImage.src = url;
                previewContainer.style.display = 'flex';
                previewImage.onerror = function() {
                    previewImage.src = 'https://via.placeholder.com/100x100/1a1a2e/46f0d2?text=Invalid+URL';
                };
            } else {
                previewContainer.style.display = 'none';
            }
        }
        
        // Handle form submission
        document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form data
            const productData = {
                name: document.getElementById('productName').value.trim(),
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                rating: parseFloat(document.getElementById('productRating').value) || 0,
                reviews: parseInt(document.getElementById('productReviews').value) || 0,
                image: document.getElementById('productImage').value.trim(),
                description: document.getElementById('productDescription').value.trim()
            };
            
            // Validate required fields
            if (!productData.name || !productData.category || !productData.description) {
                showMessage('Please fill in all required fields.', 'error');
                return;
            }
            
            if (productData.price <= 0) {
                showMessage('Price must be greater than 0.', 'error');
                return;
            }
            
            // Disable save button and show loading
            const saveBtn = document.getElementById('saveBtn');
            const saveBtnText = document.getElementById('saveBtnText');
            const saveBtnLoader = document.getElementById('saveBtnLoader');
            
            saveBtn.disabled = true;
            saveBtnText.style.display = 'none';
            saveBtnLoader.style.display = 'inline';
            
            try {
                let response, url, method;
                
                if (currentProductId) {
                    // Update existing product
                    url = `http://localhost:5000/api/admin/products/${currentProductId}`;
                    method = 'PUT';
                } else {
                    // Create new product
                    url = 'http://localhost:5000/api/admin/products';
                    method = 'POST';
                }
                
                response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(productData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Show success message
                    showMessage(data.message, 'success');
                    
                    // Close modal and reload products
                    closeProductModal();
                    loadProducts();
                    loadDashboardData(); // Update stats
                } else {
                    showMessage(data.error || 'Failed to save product.', 'error');
                }
                
            } catch (error) {
                console.error('Error saving product:', error);
                showMessage('Failed to save product. Please try again.', 'error');
            } finally {
                // Re-enable save button
                saveBtn.disabled = false;
                saveBtnText.style.display = 'inline';
                saveBtnLoader.style.display = 'none';
            }
        });
        
        // Edit product
        async function editProduct(productId) {
            try {
                // Fetch product details
                const response = await fetch(`http://localhost:5000/api/admin/products`, {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (data.success) {
                    const product = data.products.find(p => p.id === productId);
                    if (product) {
                        openProductModal(product);
                    } else {
                        showMessage('Product not found.', 'error');
                    }
                } else {
                    showMessage(data.error || 'Failed to load product details.', 'error');
                }
            } catch (error) {
                console.error('Error loading product details:', error);
                showMessage('Failed to load product details.', 'error');
            }
        }
        
        // Delete product
        async function deleteProduct(productId, productName) {
            if (!confirm(`Are you sure you want to delete "${productName}"? This action cannot be undone.`)) {
                return;
            }
            
            try {
                const response = await fetch(`http://localhost:5000/api/admin/products/${productId}`, {
                    method: 'DELETE',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('Product deleted successfully!', 'success');
                    loadProducts(); // Reload products
                    loadDashboardData(); // Update stats
                } else {
                    showMessage(data.error || 'Failed to delete product.', 'error');
                }
                
            } catch (error) {
                console.error('Error deleting product:', error);
                showMessage('Failed to delete product. Please try again.', 'error');
            }
        }
        
        // Show status message
        function showMessage(message, type = 'info') {
            const messageDiv = document.getElementById('statusMessage');
            messageDiv.innerHTML = `<div class="${type}">${message}</div>`;
            messageDiv.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
        
      // Update the showSection function
function showSection(sectionId) {
    // Hide all sections
    document.querySelectorAll('.main-content > div').forEach(div => {
        div.style.display = 'none';
    });
    
    // Show selected section
    document.getElementById(`${sectionId}-section`).style.display = 'block';
    
    // Update active menu item
    document.querySelectorAll('.sidebar-menu li').forEach(li => {
        li.classList.remove('active');
    });
    
    // Find and activate the clicked menu item
    const menuItems = document.querySelectorAll('.sidebar-menu li');
    for (let li of menuItems) {
        if (li.onclick && li.onclick.toString().includes(sectionId)) {
            li.classList.add('active');
            break;
        }
    }
    
    // Load data for specific sections
    if (sectionId === 'products') {
        loadProducts();
    } else if (sectionId === 'users') {
        loadUsers(); // Add this line
    }
}
        // Logout function
        async function logout() {
            if (!confirm('Are you sure you want to logout?')) {
                return;
            }
            
            try {
                const response = await fetch('http://localhost:5000/api/logout', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors'
                });
                
                // Clear any local storage
                localStorage.clear();
                sessionStorage.clear();
                
                // Always redirect to login page after logout attempt
                window.location.href = 'http://localhost:5000/login';
                
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = 'http://localhost:5000/login';
            }
        }
        
        // Close modal when clicking outside
        document.getElementById('productModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeProductModal();
            }
        });
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', checkAuth);


        // Load users
async function loadUsers() {
    try {
        const response = await fetch('http://localhost:5000/api/admin/users', {
            credentials: 'include'
        });
        const data = await response.json();
        
        if (data.success) {
            displayUsers(data.users);
            document.getElementById('totalUsersCount').textContent = `${data.count} Users`;
        } else {
            document.getElementById('usersTable').innerHTML = `<div class="error">Error: ${data.error || 'Failed to load users'}</div>`;
        }
        
    } catch (error) {
        console.error('Error loading users:', error);
        document.getElementById('usersTable').innerHTML = `<div class="error">Failed to load users. Please try again.</div>`;
    }
}

// Display users in table
function displayUsers(users) {
    if (!users || users.length === 0) {
        document.getElementById('usersTable').innerHTML = '<div class="loading">No users found.</div>';
        return;
    }
    
    let html = `
        <table class="users-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Joined Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    users.forEach(user => {
        const joinDate = user.created_at ? new Date(user.created_at).toLocaleDateString() : 'N/A';
        const initials = user.username ? user.username.charAt(0).toUpperCase() : 'U';
        
        html += `
            <tr>
                <td>${user.id}</td>
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="user-avatar">${initials}</div>
                        <span>${user.username}</span>
                    </div>
                </td>
                <td>${user.email}</td>
                <td>
                    <span class="role-badge ${user.role === 'admin' ? 'role-admin' : 'role-user'}">
                        ${user.role}
                    </span>
                </td>
                <td>${joinDate}</td>
                <td>
                    <div class="user-actions">
                        ${user.role === 'user' ? 
                            `<button class="action-btn promote-btn" onclick="updateUserRole(${user.id}, 'admin')">
                                <i class="fas fa-user-shield"></i> Make Admin
                            </button>` : 
                            `<button class="action-btn demote-btn" onclick="updateUserRole(${user.id}, 'user')">
                                <i class="fas fa-user"></i> Make User
                            </button>`
                        }
                        <button class="action-btn delete-user-btn" onclick="deleteUser(${user.id}, '${escapeString(user.username)}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </td>
            </tr>
        `;
    });
    
    html += `
            </tbody>
        </table>
    `;
    
    document.getElementById('usersTable').innerHTML = html;
}

// Update user role
async function updateUserRole(userId, newRole) {
    const action = newRole === 'admin' ? 'promote to admin' : 'demote to user';
    if (!confirm(`Are you sure you want to ${action} this user?`)) {
        return;
    }
    
    try {
        const response = await fetch(`http://localhost:5000/api/admin/users/${userId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include',
            body: JSON.stringify({ role: newRole })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showUserMessage(`User ${action} successfully!`, 'success');
            loadUsers(); // Reload users
            loadDashboardData(); // Update stats if needed
        } else {
            showUserMessage(data.error || `Failed to ${action} user.`, 'error');
        }
        
    } catch (error) {
        console.error('Error updating user role:', error);
        showUserMessage('Failed to update user role. Please try again.', 'error');
    }
}

// Delete user
async function deleteUser(userId, username) {
    if (!confirm(`Are you sure you want to delete user "${username}"? This action cannot be undone.`)) {
        return;
    }
    
    try {
        const response = await fetch(`http://localhost:5000/api/admin/users/${userId}`, {
            method: 'DELETE',
            credentials: 'include'
        });
        
        const data = await response.json();
        
        if (data.success) {
            showUserMessage('User deleted successfully!', 'success');
            loadUsers(); // Reload users
            loadDashboardData(); // Update stats
        } else {
            showUserMessage(data.error || 'Failed to delete user.', 'error');
        }
        
    } catch (error) {
        console.error('Error deleting user:', error);
        showUserMessage('Failed to delete user. Please try again.', 'error');
    }
}

// Show user status message
function showUserMessage(message, type = 'info') {
    const messageDiv = document.getElementById('userStatusMessage');
    messageDiv.innerHTML = `<div class="${type}">${message}</div>`;
    messageDiv.style.display = 'block';
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
        messageDiv.style.display = 'none';
    }, 5000);
}



// Load orders
async function loadOrders() {
    try {
        const response = await fetch('http://localhost:5000/api/admin/orders', {
            credentials: 'include'
        });
        const data = await response.json();
        
        if (data.success) {
            displayOrders(data.orders);
            document.getElementById('totalOrdersCount').textContent = `${data.count} Orders`;
        } else {
            document.getElementById('ordersTable').innerHTML = `<div class="error">Error: ${data.error || 'Failed to load orders'}</div>`;
        }
        
    } catch (error) {
        console.error('Error loading orders:', error);
        document.getElementById('ordersTable').innerHTML = `<div class="error">Failed to load orders. Please try again.</div>`;
    }
}

// Display orders in table
function displayOrders(orders) {
    if (!orders || orders.length === 0) {
        document.getElementById('ordersTable').innerHTML = '<div class="loading">No orders found.</div>';
        return;
    }
    
    let html = `
        <table class="orders-table">
            <thead>
                <tr>
                    <th>Order #</th>
                    <th>Customer</th>
                    <th>Items</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Shipping</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    orders.forEach(order => {
        const orderDate = order.created_at ? new Date(order.created_at).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        }) : 'N/A';
        
        // Get customer name
        let customerName = 'Guest';
        let customerInitial = 'G';
        if (order.user && order.user.username) {
            customerName = order.user.username;
            customerInitial = customerName.charAt(0).toUpperCase();
        }
        
        // Parse shipping info
        let shippingInfo = {};
        try {
            if (order.shipping_info) {
                shippingInfo = typeof order.shipping_info === 'string' 
                    ? JSON.parse(order.shipping_info) 
                    : order.shipping_info;
            }
        } catch (e) {
            shippingInfo = {};
        }
        
        // Format shipping address
        const shippingAddress = shippingInfo.address 
            ? `${shippingInfo.city || ''}, ${shippingInfo.state || ''}`.replace(', ,', ',')
            : 'Not specified';
        
        // Format order items
        const itemsList = order.items && order.items.length > 0 
            ? order.items.slice(0, 2).map(item => `
                <div class="order-item">
                    <span class="order-item-name">${item.product_name || 'Product'}</span>
                    <span class="order-item-qty">x${item.quantity}</span>
                </div>
            `).join('') + (order.items.length > 2 ? `<div style="font-size:11px;color:var(--accent-color);">+${order.items.length - 2} more</div>` : '')
            : '<div style="font-size:12px;color:rgba(255,255,255,0.5);">No items</div>';
        
        html += `
            <tr>
                <td>
                    <div class="order-number">${order.order_number}</div>
                    <div class="order-date">${orderDate}</div>
                </td>
                <td>
                    <div class="order-user">
                        <div class="order-user-avatar">${customerInitial}</div>
                        <div>
                            <div>${customerName}</div>
                            ${order.user && order.user.email ? `<div style="font-size:12px;color:rgba(255,255,255,0.6);">${order.user.email}</div>` : ''}
                        </div>
                    </div>
                </td>
                <td>
                    <div class="order-items">${itemsList}</div>
                </td>
                <td class="order-total">$${order.total_amount?.toFixed(2) || '0.00'}</td>
                <td>
                    <span class="order-status status-${order.status || 'pending'}">
                        ${order.status || 'pending'}
                    </span>
                </td>
                <td>${new Date(order.created_at).toLocaleDateString()}</td>
                <td class="order-shipping">
                    <div class="order-shipping-info">
                        <div style="font-size:12px;">${shippingAddress}</div>
                        ${shippingInfo.email ? `<div style="font-size:11px;color:rgba(255,255,255,0.6);">${shippingInfo.email}</div>` : ''}
                    </div>
                </td>
                <td>
                    <div class="order-actions">
                        <button class="order-action-btn view-details-btn" onclick="viewOrderDetails(${order.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="order-action-btn update-status-btn" onclick="updateOrderStatus(${order.id}, '${order.status || 'pending'}')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `;
    });
    
    html += `
            </tbody>
        </table>
    `;
    
    document.getElementById('ordersTable').innerHTML = html;
}

// View order details
async function viewOrderDetails(orderId) {
    try {
        // First, get the order number from the existing data
        const response = await fetch('http://localhost:5000/api/admin/orders', {
            credentials: 'include'
        });
        const data = await response.json();
        
        if (!data.success) {
            throw new Error('Failed to load orders');
        }
        
        const order = data.orders.find(o => o.id === orderId);
        if (!order) {
            showOrderMessage('Order not found', 'error');
            return;
        }
        
        // Create modal for order details
        const modal = document.createElement('div');
        modal.className = 'order-details-modal';
        
        modal.innerHTML = `
            <div class="order-details-content">
                <div class="order-details-header">
                    <h2 class="order-details-title">Order Details: ${order.order_number}</h2>
                    <button class="order-details-close" onclick="this.closest('.order-details-modal').remove()">&times;</button>
                </div>
                <div class="order-details-body">
                    <div>
                        <div class="order-info-section">
                            <h3>Order Information</h3>
                            <div class="order-details-item">
                                <span class="order-details-label">Order Number:</span>
                                <span class="order-details-value">${order.order_number}</span>
                            </div>
                            <div class="order-details-item">
                                <span class="order-details-label">Status:</span>
                                <span class="order-details-value">
                                    <span class="order-status status-${order.status || 'pending'}">
                                        ${order.status || 'pending'}
                                    </span>
                                </span>
                            </div>
                            <div class="order-details-item">
                                <span class="order-details-label">Date:</span>
                                <span class="order-details-value">${new Date(order.created_at).toLocaleString()}</span>
                            </div>
                            <div class="order-details-item">
                                <span class="order-details-label">Total Amount:</span>
                                <span class="order-details-value total">$${order.total_amount?.toFixed(2) || '0.00'}</span>
                            </div>
                        </div>
                        
                        <div class="order-info-section">
                            <h3>Customer Information</h3>
                            ${order.user ? `
                                <div class="order-details-item">
                                    <span class="order-details-label">Name:</span>
                                    <span class="order-details-value">${order.user.username || 'Guest'}</span>
                                </div>
                                <div class="order-details-item">
                                    <span class="order-details-label">Email:</span>
                                    <span class="order-details-value">${order.user.email || 'N/A'}</span>
                                </div>
                                <div class="order-details-item">
                                    <span class="order-details-label">User ID:</span>
                                    <span class="order-details-value">${order.user.id || 'N/A'}</span>
                                </div>
                            ` : '<div style="color:rgba(255,255,255,0.6);">Guest order</div>'}
                        </div>
                    </div>
                    
                    <div>
                        <div class="order-info-section">
                            <h3>Shipping Information</h3>
                            ${(() => {
                                try {
                                    const shipping = order.shipping_info 
                                        ? (typeof order.shipping_info === 'string' 
                                            ? JSON.parse(order.shipping_info) 
                                            : order.shipping_info)
                                        : {};
                                    
                                    if (!shipping || Object.keys(shipping).length === 0) {
                                        return '<div style="color:rgba(255,255,255,0.6);">No shipping information</div>';
                                    }
                                    
                                    return `
                                        <div class="order-details-item">
                                            <span class="order-details-label">Name:</span>
                                            <span class="order-details-value">${shipping.first_name || ''} ${shipping.last_name || ''}</span>
                                        </div>
                                        <div class="order-details-item">
                                            <span class="order-details-label">Email:</span>
                                            <span class="order-details-value">${shipping.email || 'N/A'}</span>
                                        </div>
                                        <div class="order-details-item">
                                            <span class="order-details-label">Phone:</span>
                                            <span class="order-details-value">${shipping.phone || 'N/A'}</span>
                                        </div>
                                        <div class="order-details-item">
                                            <span class="order-details-label">Address:</span>
                                            <span class="order-details-value">${shipping.address || 'N/A'}</span>
                                        </div>
                                        <div class="order-details-item">
                                            <span class="order-details-label">City:</span>
                                            <span class="order-details-value">${shipping.city || ''}, ${shipping.state || ''} ${shipping.zip_code || ''}</span>
                                        </div>
                                        <div class="order-details-item">
                                            <span class="order-details-label">Country:</span>
                                            <span class="order-details-value">${shipping.country || 'N/A'}</span>
                                        </div>
                                        ${shipping.notes ? `
                                            <div class="order-details-item">
                                                <span class="order-details-label">Notes:</span>
                                                <span class="order-details-value">${shipping.notes}</span>
                                            </div>
                                        ` : ''}
                                    `;
                                } catch (e) {
                                    return '<div style="color:rgba(255,255,255,0.6);">Error parsing shipping info</div>';
                                }
                            })()}
                        </div>
                        
                        <div class="order-info-section">
                            <h3>Order Items (${order.items ? order.items.length : 0})</h3>
                            <div class="order-items-list">
                                ${order.items && order.items.length > 0 
                                    ? order.items.map(item => `
                                        <div class="order-item-detail">
                                            <img src="${item.image || 'https://via.placeholder.com/50x50/1a1a2e/46f0d2?text=No+Image'}" 
                                                 alt="${item.product_name}" 
                                                 class="order-item-image"
                                                 onerror="this.src='https://via.placeholder.com/50x50/1a1a2e/46f0d2?text=No+Image'">
                                            <div class="order-item-info">
                                                <div class="order-item-name">${item.product_name || 'Product'}</div>
                                                <div class="order-item-meta">
                                                    <span>Quantity: ${item.quantity}</span>
                                                    <span>Price: $${item.price?.toFixed(2) || '0.00'}</span>
                                                    <span>Total: $${((item.price || 0) * (item.quantity || 1)).toFixed(2)}</span>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')
                                    : '<div style="color:rgba(255,255,255,0.6);">No items found</div>'
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
    } catch (error) {
        console.error('Error viewing order details:', error);
        showOrderMessage('Failed to load order details', 'error');
    }
}

// Update order status
async function updateOrderStatus(orderId, currentStatus) {
    const newStatus = prompt('Update order status (confirmed/pending/completed/cancelled):', currentStatus);
    
    if (!newStatus || !['confirmed', 'pending', 'completed', 'cancelled'].includes(newStatus.toLowerCase())) {
        showOrderMessage('Invalid status. Use: confirmed, pending, completed, or cancelled', 'error');
        return;
    }
    
    // Note: You'll need to implement a backend endpoint for this
    // For now, we'll just show a message
    showOrderMessage('Order status update endpoint not implemented yet. Status remains: ' + currentStatus, 'info');
    
    // To implement this fully, you would need:
    // 1. Add a new endpoint: PUT /api/admin/orders/{order_id}/status
    // 2. Make an API call to update the status
    // 3. Reload the orders after successful update
}

// Show order status message
function showOrderMessage(message, type = 'info') {
    const messageDiv = document.getElementById('orderStatusMessage');
    messageDiv.innerHTML = `<div class="${type}">${message}</div>`;
    messageDiv.style.display = 'block';
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
        messageDiv.style.display = 'none';
    }, 5000);
}

// Update the showSection function to load orders
function showSection(sectionId) {
    // Hide all sections
    document.querySelectorAll('.main-content > div').forEach(div => {
        div.style.display = 'none';
    });
    
    // Show selected section
    document.getElementById(`${sectionId}-section`).style.display = 'block';
    
    // Update active menu item
    document.querySelectorAll('.sidebar-menu li').forEach(li => {
        li.classList.remove('active');
    });
    
    // Find and activate the clicked menu item
    const menuItems = document.querySelectorAll('.sidebar-menu li');
    for (let li of menuItems) {
        if (li.onclick && li.onclick.toString().includes(sectionId)) {
            li.classList.add('active');
            break;
        }
    }
    
    // Load data for specific sections
    if (sectionId === 'products') {
        loadProducts();
    } else if (sectionId === 'users') {
        loadUsers();
    } else if (sectionId === 'orders') {
        loadOrders(); // Add this line
    }
}


// Global variables for order items
let orderItems = [];
let orderItemsViewMode = 'table'; // 'table' or 'cards'
let allOrders = [];
let allProducts = [];

// Load order items
async function loadOrderItems() {
    try {
        const response = await fetch('http://localhost:5000/api/admin/order-items', {
            credentials: 'include'
        });
        const data = await response.json();
        
        if (data.success) {
            orderItems = data.order_items || [];
            document.getElementById('totalOrderItemsCount').textContent = `${orderItems.length} Items`;
            
            // Load orders and products for filters
            await loadOrdersForFilter();
            await loadProductsForFilter();
            
            // Display based on current view mode
            if (orderItemsViewMode === 'cards') {
                displayOrderItemsCards();
            } else {
                displayOrderItemsTable();
            }
        } else {
            document.getElementById('orderItemsTable').innerHTML = `<div class="error">Error: ${data.error || 'Failed to load order items'}</div>`;
        }
        
    } catch (error) {
        console.error('Error loading order items:', error);
        document.getElementById('orderItemsTable').innerHTML = `<div class="error">Failed to load order items. Please try again.</div>`;
    }
}

// Load orders for filter dropdown
async function loadOrdersForFilter() {
    try {
        const response = await fetch('http://localhost:5000/api/admin/orders', {
            credentials: 'include'
        });
        const data = await response.json();
        
        if (data.success) {
            allOrders = data.orders || [];
            updateOrderFilter();
        }
    } catch (error) {
        console.error('Error loading orders for filter:', error);
    }
}

// Load products for filter dropdown
async function loadProductsForFilter() {
    try {
        const response = await fetch('http://localhost:5000/api/admin/products', {
            credentials: 'include'
        });
        const data = await response.json();
        
        if (data.success) {
            allProducts = data.products || [];
            updateProductFilter();
        }
    } catch (error) {
        console.error('Error loading products for filter:', error);
    }
}

// Update order filter dropdown
function updateOrderFilter() {
    const filterSelect = document.getElementById('filterOrder');
    
    // Keep current selection
    const currentValue = filterSelect.value;
    
    // Clear and add options
    filterSelect.innerHTML = '<option value="">All Orders</option>';
    
    // Sort orders by date (newest first)
    const sortedOrders = [...allOrders].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
    
    sortedOrders.forEach(order => {
        const option = document.createElement('option');
        option.value = order.id;
        option.textContent = `${order.order_number} - $${order.total_amount?.toFixed(2) || '0.00'}`;
        filterSelect.appendChild(option);
    });
    
    // Restore selection if it still exists
    if (currentValue) {
        filterSelect.value = currentValue;
    }
}

// Update product filter dropdown
function updateProductFilter() {
    const filterSelect = document.getElementById('filterProduct');
    
    // Keep current selection
    const currentValue = filterSelect.value;
    
    // Clear and add options
    filterSelect.innerHTML = '<option value="">All Products</option>';
    
    allProducts.forEach(product => {
        const option = document.createElement('option');
        option.value = product.id;
        option.textContent = `${product.name} - $${product.price?.toFixed(2) || '0.00'}`;
        filterSelect.appendChild(option);
    });
    
    // Restore selection if it still exists
    if (currentValue) {
        filterSelect.value = currentValue;
    }
}

// Filter order items
function filterOrderItems() {
    const orderFilter = document.getElementById('filterOrder').value;
    const productFilter = document.getElementById('filterProduct').value;
    
    let filteredItems = [...orderItems];
    
    // Apply order filter
    if (orderFilter) {
        filteredItems = filteredItems.filter(item => item.order_id == orderFilter);
    }
    
    // Apply product filter
    if (productFilter) {
        filteredItems = filteredItems.filter(item => item.product_id == productFilter);
    }
    
    // Display filtered items
    if (orderItemsViewMode === 'cards') {
        displayOrderItemsCards(filteredItems);
    } else {
        displayOrderItemsTable(filteredItems);
    }
    
    // Update count
    document.getElementById('totalOrderItemsCount').textContent = `${filteredItems.length} Items`;
}

// Display order items in table view
function displayOrderItemsTable(items = orderItems) {
    if (!items || items.length === 0) {
        document.getElementById('orderItemsTable').innerHTML = '<div class="loading">No order items found.</div>';
        return;
    }
    
    // Add view toggle buttons
    const viewToggle = `
        <div class="view-toggle">
            <button class="view-toggle-btn ${orderItemsViewMode === 'table' ? 'active' : ''}" 
                    onclick="setOrderItemsViewMode('table')">
                <i class="fas fa-table"></i> Table View
            </button>
            <button class="view-toggle-btn ${orderItemsViewMode === 'cards' ? 'active' : ''}" 
                    onclick="setOrderItemsViewMode('cards')">
                <i class="fas fa-th-large"></i> Card View
            </button>
        </div>
    `;
    
    let html = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0;">Order Items (${items.length})</h3>
            ${viewToggle}
        </div>
        <table class="order-items-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Order</th>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Total</th>
                    <th>Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    // Sort by date (newest first)
    const sortedItems = [...items].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
    
    sortedItems.forEach(item => {
        const order = allOrders.find(o => o.id == item.order_id);
        const product = allProducts.find(p => p.id == item.product_id);
        const orderDate = item.created_at ? new Date(item.created_at).toLocaleDateString() : 'N/A';
        const itemTotal = (item.price || 0) * (item.quantity || 1);
        
        html += `
            <tr>
                <td>${item.id}</td>
                <td class="order-number-cell">
                    ${order ? order.order_number : `Order #${item.order_id}`}
                </td>
                <td>
                    <div class="order-item-details">
                        <img src="${product?.image || 'https://via.placeholder.com/60x60/1a1a2e/46f0d2?text=Product'}" 
                             alt="${product?.name || 'Product'}" 
                             class="order-item-image"
                             onerror="this.src='https://via.placeholder.com/60x60/1a1a2e/46f0d2?text=Product'">
                        <div class="order-item-info">
                            <div class="order-item-name">${product?.name || 'Product #' + item.product_id}</div>
                            <div class="order-item-meta">ID: ${item.product_id}</div>
                        </div>
                    </div>
                </td>
                <td><span class="order-item-quantity">${item.quantity || 1}</span></td>
                <td class="order-item-price">$${item.price?.toFixed(2) || '0.00'}</td>
                <td class="order-item-total">$${itemTotal.toFixed(2)}</td>
                <td class="order-item-date">${orderDate}</td>
                <td><span class="order-item-status status-sold">SOLD</span></td>
            </tr>
        `;
    });
    
    html += `
            </tbody>
        </table>
    `;
    
    document.getElementById('orderItemsTable').innerHTML = html;
}

// Display order items in card view
function displayOrderItemsCards(items = orderItems) {
    if (!items || items.length === 0) {
        document.getElementById('orderItemsTable').innerHTML = '<div class="loading">No order items found.</div>';
        return;
    }
    
    // Add view toggle buttons
    const viewToggle = `
        <div class="view-toggle">
            <button class="view-toggle-btn ${orderItemsViewMode === 'table' ? 'active' : ''}" 
                    onclick="setOrderItemsViewMode('table')">
                <i class="fas fa-table"></i> Table View
            </button>
            <button class="view-toggle-btn ${orderItemsViewMode === 'cards' ? 'active' : ''}" 
                    onclick="setOrderItemsViewMode('cards')">
                <i class="fas fa-th-large"></i> Card View
            </button>
        </div>
    `;
    
    let html = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0;">Order Items (${items.length})</h3>
            ${viewToggle}
        </div>
        <div class="order-items-cards">
    `;
    
    // Sort by date (newest first)
    const sortedItems = [...items].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
    
    sortedItems.forEach(item => {
        const order = allOrders.find(o => o.id == item.order_id);
        const product = allProducts.find(p => p.id == item.product_id);
        const orderDate = item.created_at ? new Date(item.created_at).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        }) : 'N/A';
        const itemTotal = (item.price || 0) * (item.quantity || 1);
        
        html += `
            <div class="order-item-card">
                <div class="order-item-card-header">
                    <div>
                        <div class="order-item-order">${order ? order.order_number : `Order #${item.order_id}`}</div>
                        <div class="order-item-date">${orderDate}</div>
                    </div>
                    <span class="order-item-status status-sold">SOLD</span>
                </div>
                
                <div class="order-item-card-body">
                    <img src="${product?.image || 'https://via.placeholder.com/80x80/1a1a2e/46f0d2?text=Product'}" 
                         alt="${product?.name || 'Product'}" 
                         class="order-item-card-image"
                         onerror="this.src='https://via.placeholder.com/80x80/1a1a2e/46f0d2?text=Product'">
                    <div class="order-item-card-info">
                        <div class="order-item-card-name">${product?.name || 'Product #' + item.product_id}</div>
                        <div class="order-item-card-meta">Product ID: ${item.product_id}</div>
                        <div class="order-item-card-meta">Order ID: ${item.order_id}</div>
                        <div class="order-item-card-meta">Item ID: ${item.id}</div>
                    </div>
                </div>
                
                <div class="order-item-card-footer">
                    <div>
                        <div style="font-size: 14px; color: rgba(255, 255, 255, 0.6); margin-bottom: 5px;">Price  Quantity</div>
                        <div class="order-item-card-price">$${item.price?.toFixed(2) || '0.00'}  ${item.quantity || 1}</div>
                    </div>
                    <div class="order-item-card-quantity">
                        <span class="quantity-badge">${item.quantity || 1} units</span>
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; font-weight: 600; font-size: 16px;">
                        <span>Item Total:</span>
                        <span style="color: var(--accent-color);">$${itemTotal.toFixed(2)}</span>
                    </div>
                </div>
                
                <div class="order-item-card-actions" style="margin-top: 15px;">
                    ${product ? `
                        <button class="order-item-card-btn btn-view-product" onclick="viewProduct(${product.id})">
                            <i class="fas fa-box"></i> View Product
                        </button>
                    ` : ''}
                    ${order ? `
                        <button class="order-item-card-btn btn-view-order" onclick="viewOrderDetails(${order.id})">
                            <i class="fas fa-shopping-cart"></i> View Order
                        </button>
                    ` : ''}
                </div>
            </div>
        `;
    });
    
    html += `</div>`;
    
    document.getElementById('orderItemsTable').innerHTML = html;
}

// Set view mode for order items
function setOrderItemsViewMode(mode) {
    orderItemsViewMode = mode;
    if (mode === 'cards') {
        displayOrderItemsCards();
    } else {
        displayOrderItemsTable();
    }
}

// View product details
function viewProduct(productId) {
    alert(`View product ${productId} - You can implement a product modal here`);
    // You can implement a modal to view product details
}

// Update showSection function to handle order-items
function showSection(sectionId) {
    // Hide all sections
    document.querySelectorAll('.main-content > div').forEach(div => {
        div.style.display = 'none';
    });
    
    // Show selected section
    document.getElementById(`${sectionId}-section`).style.display = 'block';
    
    // Update active menu item
    document.querySelectorAll('.sidebar-menu li').forEach(li => {
        li.classList.remove('active');
    });
    
    // Find and activate the clicked menu item
    const menuItems = document.querySelectorAll('.sidebar-menu li');
    for (let li of menuItems) {
        if (li.onclick && li.onclick.toString().includes(sectionId)) {
            li.classList.add('active');
            break;
        }
    }
    
    // Load data for specific sections
    if (sectionId === 'products') {
        loadProducts();
    } else if (sectionId === 'users') {
        loadUsers();
    } else if (sectionId === 'orders') {
        loadOrders();
    } else if (sectionId === 'order-items') {
        loadOrderItems(); // Add this line
    }
}

// Show order items status message
function showOrderItemsMessage(message, type = 'info') {
    const messageDiv = document.getElementById('orderItemsStatusMessage');
    messageDiv.innerHTML = `<div class="${type}">${message}</div>`;
    messageDiv.style.display = 'block';
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
        messageDiv.style.display = 'none';
    }, 5000);
}



//analytics section 
// Global chart instances
let salesTrendChart = null;
let categoryChart = null;
let hourlyChart = null;

// Set today's date
function setTodayDate() {
    const today = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('todayDate').textContent = today.toLocaleDateString('en-US', options);
}

// Load analytics data
async function loadAnalytics() {
    try {
        showAnalyticsLoading(true);
        
        const period = document.getElementById('analyticsPeriod').value;
        
        // Load analytics summary
        const summaryResponse = await fetch(`http://localhost:5000/api/admin/analytics/summary?period=${period}`, {
            credentials: 'include'
        });
        const summaryData = await summaryResponse.json();
        
        if (summaryData.success) {
            updateAnalyticsSummary(summaryData);
            updateTopProductsTable(summaryData.top_products);
            updateRecentOrdersTable(summaryData.recent_orders);
        }
        
        // Load sales trend
        const trendResponse = await fetch(`http://localhost:5000/api/admin/analytics/sales-trend?period=${period}`, {
            credentials: 'include'
        });
        const trendData = await trendResponse.json();
        
        if (trendData.success) {
            updateSalesTrendChart(trendData);
        }
        
        // Load category sales
        if (summaryData.success && summaryData.category_sales) {
            updateCategoryChart(summaryData.category_sales);
        }
        
        // Load hourly sales
        const hourlyResponse = await fetch('http://localhost:5000/api/admin/analytics/hourly-sales', {
            credentials: 'include'
        });
        const hourlyData = await hourlyResponse.json();
        
        if (hourlyData.success) {
            updateHourlyChart(hourlyData);
        }
        
    } catch (error) {
        console.error('Error loading analytics:', error);
        showAnalyticsMessage('Failed to load analytics data. Please try again.', 'error');
    } finally {
        showAnalyticsLoading(false);
    }
}

// Update analytics summary cards
function updateAnalyticsSummary(data) {
    const summary = data.summary;
    
    // Revenue card
    document.getElementById('analyticsRevenue').textContent = `$${summary.total_revenue.toLocaleString()}`;
    
    const revenueChange = document.getElementById('revenueChange');
    const changeIndicator = revenueChange.querySelector('.change-indicator');
    const changeLabel = revenueChange.querySelector('.change-label');
    
    if (summary.revenue_growth > 0) {
        changeIndicator.className = 'change-indicator change-positive';
        changeIndicator.innerHTML = `<i class="fas fa-arrow-up"></i> ${Math.abs(summary.revenue_growth)}%`;
        changeLabel.textContent = `vs yesterday ($${summary.yesterday_revenue})`;
    } else if (summary.revenue_growth < 0) {
        changeIndicator.className = 'change-indicator change-negative';
        changeIndicator.innerHTML = `<i class="fas fa-arrow-down"></i> ${Math.abs(summary.revenue_growth)}%`;
        changeLabel.textContent = `vs yesterday ($${summary.yesterday_revenue})`;
    } else {
        changeIndicator.className = 'change-indicator change-neutral';
        changeIndicator.textContent = '0%';
        changeLabel.textContent = summary.yesterday_revenue > 0 ? `vs yesterday ($${summary.yesterday_revenue})` : 'No data yesterday';
    }
    
    // Orders card
    document.getElementById('totalOrdersAnalytics').textContent = summary.total_orders.toLocaleString();
    document.getElementById('todayOrders').textContent = `Today: ${summary.today_orders} orders`;
    
    // Average order value
    document.getElementById('avgOrderValue').textContent = `$${summary.avg_order_value.toFixed(2)}`;
    
    // Top product
    if (data.top_products && data.top_products.length > 0) {
        const topProduct = data.top_products[0];
        document.getElementById('topProductName').textContent = topProduct.name;
        document.getElementById('topProductSales').textContent = `${topProduct.total_quantity} units sold ($${topProduct.total_revenue.toFixed(2)})`;
    }
}

// Update sales trend chart
function updateSalesTrendChart(data) {
    const ctx = document.getElementById('salesTrendChart').getContext('2d');
    
    // Destroy existing chart if it exists
    if (salesTrendChart) {
        salesTrendChart.destroy();
    }
    
    salesTrendChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [
                {
                    label: 'Revenue',
                    data: data.revenue_data,
                    borderColor: 'rgba(70, 240, 210, 1)',
                    backgroundColor: 'rgba(70, 240, 210, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4,
                    yAxisID: 'y'
                },
                {
                    label: 'Orders',
                    data: data.orders_data,
                    borderColor: 'rgba(40, 167, 69, 1)',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4,
                    yAxisID: 'y1'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    mode: 'index',
                    intersect: false
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)',
                        maxTicksLimit: 10
                    }
                },
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)',
                        callback: function(value) {
                            return '$' + value;
                        }
                    }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)'
                    }
                }
            }
        }
    });
}

// Update category chart
let categoryChartType = 'bar';
function updateCategoryChart(categoryData) {
    const ctx = document.getElementById('categoryChart').getContext('2d');
    
    // Destroy existing chart if it exists
    if (categoryChart) {
        categoryChart.destroy();
    }
    
    const labels = categoryData.map(c => c.category);
    const revenueData = categoryData.map(c => c.total_revenue);
    
    categoryChart = new Chart(ctx, {
        type: categoryChartType,
        data: {
            labels: labels,
            datasets: [{
                label: 'Revenue',
                data: revenueData,
                backgroundColor: [
                    'rgba(70, 240, 210, 0.7)',
                    'rgba(40, 167, 69, 0.7)',
                    'rgba(255, 193, 7, 0.7)',
                    'rgba(13, 110, 253, 0.7)',
                    'rgba(220, 53, 69, 0.7)',
                    'rgba(111, 66, 193, 0.7)',
                    'rgba(253, 126, 20, 0.7)'
                ],
                borderColor: [
                    'rgba(70, 240, 210, 1)',
                    'rgba(40, 167, 69, 1)',
                    'rgba(255, 193, 7, 1)',
                    'rgba(13, 110, 253, 1)',
                    'rgba(220, 53, 69, 1)',
                    'rgba(111, 66, 193, 1)',
                    'rgba(253, 126, 20, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `$${context.raw.toFixed(2)}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)'
                    }
                },
                y: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)',
                        callback: function(value) {
                            return '$' + value;
                        }
                    }
                }
            }
        }
    });
}

// Update hourly chart
function updateHourlyChart(data) {
    const ctx = document.getElementById('hourlyChart').getContext('2d');
    
    // Destroy existing chart if it exists
    if (hourlyChart) {
        hourlyChart.destroy();
    }
    
    hourlyChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'Revenue',
                data: data.revenue_data,
                backgroundColor: 'rgba(70, 240, 210, 0.7)',
                borderColor: 'rgba(70, 240, 210, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `$${context.raw.toFixed(2)}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)',
                        maxTicksLimit: 12
                    }
                },
                y: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)',
                        callback: function(value) {
                            return '$' + value;
                        }
                    }
                }
            }
        }
    });
}

// Toggle chart type
function toggleChartType(chartId) {
    if (chartId === 'categoryChart' && categoryChart) {
        categoryChartType = categoryChartType === 'bar' ? 'pie' : 'bar';
        const categoryData = categoryChart.data.datasets[0].data.map((value, index) => ({
            category: categoryChart.data.labels[index],
            total_revenue: value
        }));
        updateCategoryChart(categoryData);
    }
}

// Update top products table
function updateTopProductsTable(topProducts) {
    const tableBody = document.querySelector('#topProductsTable tbody');
    
    if (!topProducts || topProducts.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="5" class="loading-cell">No products sold in this period</td>
            </tr>
        `;
        return;
    }
    
    let html = '';
    
    // Find max quantity for percentage calculation
    const maxQuantity = Math.max(...topProducts.map(p => p.total_quantity));
    
    topProducts.forEach(product => {
        const avgPrice = product.total_revenue / product.total_quantity;
        const percentage = (product.total_quantity / maxQuantity) * 100;
        
        html += `
            <tr>
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 30px; height: 30px; border-radius: 5px; background: rgba(70, 240, 210, 0.1); display: flex; align-items: center; justify-content: center; color: var(--accent-color);">
                            <i class="fas fa-box"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600;">${product.name}</div>
                            <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6);">ID: ${product.product_id}</div>
                        </div>
                    </div>
                </td>
                <td style="font-weight: 600; color: var(--accent-color);">${product.total_quantity}</td>
                <td>$${product.total_revenue.toFixed(2)}</td>
                <td>$${avgPrice.toFixed(2)}</td>
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="performance-bar">
                            <div class="performance-fill" style="width: ${percentage}%"></div>
                        </div>
                        <span style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">${percentage.toFixed(0)}%</span>
                    </div>
                </td>
            </tr>
        `;
    });
    
    tableBody.innerHTML = html;
}

// Update recent orders table
function updateRecentOrdersTable(recentOrders) {
    const tableBody = document.querySelector('#recentOrdersTable tbody');
    
    if (!recentOrders || recentOrders.length === 0) {
        tableBody.innerHTML = `
            <tr>
                <td colspan="6" class="loading-cell">No recent orders</td>
            </tr>
        `;
        return;
    }
    
    let html = '';
    
    recentOrders.forEach(order => {
        const orderDate = order.created_at ? new Date(order.created_at).toLocaleDateString() : 'N/A';
        const customerName = order.user ? order.user.username : 'Guest';
        
        html += `
            <tr>
                <td>
                    <div style="font-family: 'Courier New', monospace; color: var(--accent-color); font-weight: 600;">
                        ${order.order_number}
                    </div>
                </td>
                <td>${customerName}</td>
                <td style="font-weight: 600; color: var(--accent-color);">$${order.total_amount?.toFixed(2) || '0.00'}</td>
                <td>
                    <span class="order-status status-${order.status || 'pending'}">
                        ${order.status || 'pending'}
                    </span>
                </td>
                <td>${orderDate}</td>
                <td>
                    <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">
                        ${order.items ? order.items.length : 0} items
                    </div>
                </td>
            </tr>
        `;
    });
    
    tableBody.innerHTML = html;
}

// Show analytics loading state
function showAnalyticsLoading(show) {
    const cards = document.querySelectorAll('.analytics-card-value, .analytics-card-subtitle');
    const tables = document.querySelectorAll('.analytics-table tbody');
    
    if (show) {
        cards.forEach(card => {
            card.innerHTML = `<span class="loading-text">Loading...</span>`;
        });
        
        tables.forEach(table => {
            table.innerHTML = `
                <tr>
                    <td colspan="10" class="loading-cell">
                        <i class="fas fa-spinner fa-spin"></i> Loading data...
                    </td>
                </tr>
            `;
        });
    }
}

// Show analytics message
function showAnalyticsMessage(message, type = 'info') {
    const messageDiv = document.getElementById('analyticsStatusMessage');
    messageDiv.innerHTML = `<div class="${type}">${message}</div>`;
    messageDiv.style.display = 'block';
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
        messageDiv.style.display = 'none';
    }, 5000);
}

// Update showSection function to handle analytics
function showSection(sectionId) {
    // Hide all sections
    document.querySelectorAll('.main-content > div').forEach(div => {
        div.style.display = 'none';
    });
    
    // Show selected section
    document.getElementById(`${sectionId}-section`).style.display = 'block';
    
    // Update active menu item
    document.querySelectorAll('.sidebar-menu li').forEach(li => {
        li.classList.remove('active');
    });
    
    // Find and activate the clicked menu item
    const menuItems = document.querySelectorAll('.sidebar-menu li');
    for (let li of menuItems) {
        if (li.onclick && li.onclick.toString().includes(sectionId)) {
            li.classList.add('active');
            break;
        }
    }
    
    // Load data for specific sections
    if (sectionId === 'products') {
        loadProducts();
    } else if (sectionId === 'users') {
        loadUsers();
    } else if (sectionId === 'orders') {
        loadOrders();
    } else if (sectionId === 'order-items') {
        loadOrderItems();
    } else if (sectionId === 'analytics') {
        setTodayDate();
        loadAnalytics();
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    checkAuth();
    setTodayDate(); // Add this line
});
    </script>
</body>
</html>